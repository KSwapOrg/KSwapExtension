<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KSwap Wallet Extension</title>
  <link rel="stylesheet" href="popup.css?v=2.0.2">
</head>
<body>
    <!-- Load KeetaNet SDK with proper CommonJS setup -->
    <script src="../lib/keeta-sdk-setup.js?v=2.0.2"></script>
    <!-- Load wallet client -->
    <script src="../lib/wallet-client-real.js?v=2.0.2"></script>
  <div id="app">
    <div class="wallet-container">
      <!-- Header -->
      <header class="wallet-header">
        <div class="header-top">
          <div class="logo">
            <img src="../../icons/KSwapLogo.png" alt="Keeta" class="logo-icon">
            <div class="logo-text">
              <h1>KSwap Wallet</h1>
              <div class="version-info">
                <span class="version">v2.0.2</span>
                <span class="divider">‚Ä¢</span>
                <a href="https://github.com/KSwapOrg/KSwapExtension" target="_blank" class="github-link" title="View on GitHub">GitHub</a>
                <span class="divider">‚Ä¢</span>
                <a href="https://github.com/KSwapOrg/KSwapExtension/blob/main/LICENSE" target="_blank" class="license-link" title="View License">BSL 1.1</a>
              </div>
            </div>
          </div>
          <button id="themeToggle" class="theme-toggle" title="Toggle theme">
            <span class="theme-icon">üåô</span>
          </button>
        </div>
        <div class="header-bottom">
          <div class="wallet-selector">
            <select id="walletSelect" class="wallet-select">
              <option value="default">Main Wallet</option>
            </select>
            <button id="addWalletBtn" class="add-wallet-btn" title="Add wallet">+</button>
          </div>
          <div class="network-selector">
            <select id="modeSelect">
              <option value="testnet">Testnet (Real)</option>
              <option value="mainnet">Mainnet (Real)</option>
            </select>
          </div>
        </div>
      </header>

      <!-- Connection Status -->
      <div id="connectionStatus" class="connection-status">
        <div class="status-indicator"></div>
        <span id="statusText">Connecting...</span>
      </div>

      <!-- Wallet Content -->
      <div id="walletContent" class="wallet-content hidden">
        <!-- Account Info -->
        <div class="account-section">
          <div class="account-address">
            <label>Address:</label>
            <div id="walletAddress" class="address-display"></div>
            <button id="copyAddress" class="copy-btn">Copy</button>
          </div>
        </div>

        <!-- Balance Section -->
        <div class="balance-section">
          <h2>Balances</h2>
          <div id="tokenList" class="token-list">
            <!-- Token balances will be populated here -->
          </div>
        </div>

        <!-- Actions -->
        <div class="actions-section">
          <button id="sendBtn" class="action-btn primary">Send</button>
          <button id="receiveBtn" class="action-btn secondary">Receive</button>
          <button id="settingsBtn" class="action-btn secondary">Settings</button>
        </div>
      </div>

      <!-- Send Modal -->
      <div id="sendModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Send Tokens</h3>
            <button id="closeSend" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="sendToken">Token:</label>
              <select id="sendToken">
                <!-- Options populated dynamically -->
              </select>
            </div>
            <div class="form-group">
              <label for="sendTo">To Address:</label>
              <input type="text" id="sendTo" placeholder="keeta_...">
            </div>
            <div class="form-group">
              <label for="sendAmount">Amount:</label>
              <input type="number" id="sendAmount" placeholder="0.0" step="0.000000001">
            </div>
            <div class="form-actions">
              <button id="confirmSend" class="action-btn primary">Send</button>
              <button id="cancelSend" class="action-btn secondary">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Settings</h3>
            <button id="closeSettings" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <!-- Theme Settings -->
            <div class="setting-group">
              <h4>Appearance</h4>
              <div class="setting-item">
                <label for="themeSelect">Theme:</label>
                <select id="themeSelect" class="setting-select">
                  <option value="light">Light</option>
                  <option value="dark">Dark</option>
                  <option value="auto">Auto (System)</option>
                </select>
              </div>
            </div>

            <!-- Wallet Management -->
            <div class="setting-group">
              <h4>Wallet Management</h4>
              <div class="setting-item">
                <button id="showSeedPhrase" class="action-btn secondary full-width">
                  <span class="icon">üîê</span>
                  Show Secret Recovery Phrase
                </button>
                <p class="setting-description">Display your 12-word recovery phrase</p>
              </div>
              <div class="setting-item">
                <button id="importWallet" class="action-btn secondary full-width">
                  <span class="icon">üì•</span>
                  Import Wallet
                </button>
                <p class="setting-description">Import wallet from recovery phrase</p>
              </div>
              <div class="setting-item">
                <button id="createNewWallet" class="action-btn secondary full-width">
                  <span class="icon">‚ûï</span>
                  Create New Wallet
                </button>
                <p class="setting-description">Generate a new wallet with recovery phrase</p>
              </div>
            </div>

            <!-- Account Management -->
            <div class="setting-group">
              <h4>Accounts</h4>
              <div class="setting-item">
                <button id="addAccount" class="action-btn secondary full-width">
                  <span class="icon">üë§</span>
                  Add Account
                </button>
                <p class="setting-description">Create additional account from same recovery phrase</p>
              </div>
            </div>

            <!-- Network Info -->
            <div class="setting-group">
              <h4>Network Information</h4>
              <div class="setting-item">
                <label>Current Network:</label>
                <span id="currentNetwork" class="setting-value"></span>
              </div>
              <div class="setting-item">
                <label>Wallet Address:</label>
                <span id="currentAddress" class="setting-value address-text"></span>
              </div>
            </div>

            <!-- Security -->
            <div class="setting-group">
              <h4>Security</h4>
              <div class="setting-item">
                <button id="lockWallet" class="action-btn danger full-width">
                  <span class="icon">üîí</span>
                  Lock Wallet
                </button>
                <p class="setting-description">Require password to unlock</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Seed Phrase Display Modal -->
      <div id="seedPhraseModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>üîê Secret Recovery Phrase</h3>
            <button id="closeSeedPhrase" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="warning-box">
              <p class="warning-text">‚ö†Ô∏è <strong>Never share your recovery phrase!</strong></p>
              <p>Anyone with this phrase can control your wallet and funds.</p>
            </div>
            <div id="seedPhraseDisplay" class="seed-phrase-display">
              <!-- 12-word grid will be populated here -->
            </div>
            <div class="seed-actions">
              <button id="copySeedPhrase" class="action-btn secondary">
                <span class="icon">üìã</span>
                Copy to Clipboard
              </button>
              <button id="downloadSeedPhrase" class="action-btn secondary">
                <span class="icon">üíæ</span>
                Download Backup
              </button>
            </div>
            <div class="security-checklist">
              <h4>Security Checklist:</h4>
              <label class="checkbox-item">
                <input type="checkbox" id="securityCheck1">
                I have written down my recovery phrase
              </label>
              <label class="checkbox-item">
                <input type="checkbox" id="securityCheck2">
                I understand this phrase controls my wallet
              </label>
              <label class="checkbox-item">
                <input type="checkbox" id="securityCheck3">
                I will never share this phrase with anyone
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Import Wallet Modal -->
      <div id="importWalletModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>üì• Import Wallet</h3>
            <button id="closeImportWallet" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="import-options">
              <div class="import-method active" data-method="phrase">
                <h4>üî§ Recovery Phrase</h4>
                <p>Import using 12 or 24-word BIP39 recovery phrase</p>
              </div>
              <div class="import-method" data-method="seed">
                <h4>üîë Raw Seed</h4>
                <p>Import using 64-character hex seed (advanced)</p>
              </div>
            </div>
            <div class="import-content">
              <!-- BIP39 Phrase Import -->
              <div id="phraseImport" class="import-section">
                <label for="seedPhraseInput">Enter your recovery phrase:</label>
                <textarea 
                  id="seedPhraseInput" 
                  class="seed-input" 
                  placeholder="word1 word2 word3 word4 word5 word6 word7 word8 word9 word10 word11 word12"
                  rows="4"
                ></textarea>
                <div class="phrase-validation">
                  <span id="phraseStatus" class="validation-status"></span>
                  <span id="phraseWordCount" class="word-count">0 words</span>
                </div>
                <div class="import-actions">
                  <button id="confirmPhraseImport" class="action-btn primary full-width" disabled>
                    Import from Recovery Phrase
                  </button>
                </div>
              </div>
              
              <!-- Raw Seed Import -->
              <div id="seedImport" class="import-section hidden">
                <label for="rawSeedInput">Enter your 64-character hex seed:</label>
                <input 
                  type="text" 
                  id="rawSeedInput" 
                  class="seed-input" 
                  placeholder="512FE49DC49C486057E4AE1AC8AA6F75214C0ED010581B2E15A951F208240C22"
                  maxlength="64"
                />
                <div class="seed-validation">
                  <span id="seedStatus" class="validation-status"></span>
                  <span id="seedLength" class="char-count">0/64 characters</span>
                </div>
                
                <!-- Quick Import for Funded Wallet -->
                <div class="quick-import">
                  <p class="helper-text">üí° <strong>Have the wallet with 10 KTA?</strong></p>
                  <p class="helper-text">Your funded address: <code>keeta_aabaeenxurt2cvnpqeunx65f6x247tmo2jjnkmmppadtwvysry7jzbph5fn3dnq</code></p>
                  <button id="importFundedWallet" class="action-btn secondary full-width">
                    Import My Funded Wallet (10 KTA)
                  </button>
                </div>
                
                <div class="import-actions">
                  <button id="confirmSeedImport" class="action-btn primary full-width" disabled>
                    Import from Raw Seed
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Create New Wallet Modal -->
      <div id="createWalletModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>‚ûï Create New Wallet</h3>
            <button id="closeCreateWallet" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="create-content">
              <div class="info-section">
                <h4>üöÄ Ready to create your wallet?</h4>
                <p>We'll generate a secure wallet for you instantly. You can backup your recovery phrase later in Settings.</p>
                
                <div class="create-options">
                  <div class="option-card">
                    <h5>üéØ Quick Setup</h5>
                    <p>Create wallet now, backup later</p>
                    <button id="quickCreateWallet" class="action-btn primary full-width">
                      Create Wallet Now
                    </button>
                  </div>
                  
                  <div class="option-divider">OR</div>
                  
                  <div class="option-card">
                    <h5>üîê Advanced Setup</h5>
                    <p>Generate and verify recovery phrase</p>
                    <button id="advancedCreateWallet" class="action-btn secondary full-width">
                      Advanced Setup
                    </button>
                  </div>
                  
                  <div class="option-divider">OR</div>
                  
                  <div class="option-card">
                    <h5>üì• Import Existing</h5>
                    <p>Import from recovery phrase</p>
                    <button id="importExistingWallet" class="action-btn secondary full-width">
                      Import Wallet
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Advanced creation flow (hidden by default) -->
              <div id="advancedFlow" class="advanced-flow hidden">
                <div class="advanced-step active" data-step="1">
                  <h4>Generate Recovery Phrase</h4>
                  <p>We'll generate a 12-word recovery phrase for you.</p>
                  <button id="generateAdvancedPhrase" class="action-btn primary full-width">
                    Generate Recovery Phrase
                  </button>
                </div>
                
                <div class="advanced-step hidden" data-step="2">
                  <h4>Your Recovery Phrase</h4>
                  <div class="info-box">
                    <p>üí° Save these words in a secure location. You can always view them later in Settings.</p>
                  </div>
                  <div id="advancedSeedPhraseDisplay" class="seed-phrase-display">
                    <!-- Generated phrase will appear here -->
                  </div>
                  <div class="advanced-actions">
                    <button id="finishAdvancedSetup" class="action-btn primary full-width">
                      Finish Setup
                    </button>
                    <button id="backToQuick" class="action-btn secondary full-width">
                      Skip & Create Quick Wallet
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p id="loadingText">Processing...</p>
      </div>
    </div>
  </div>

  <script src="popup.js?v=2.0.2"></script>
</body>
</html>
